services:
    datastore:
        image: datastore
        entrypoint:
            - /app/datastore
            - /app/${DATA_NAME}
        ports:
            - "8081:8081"

    wrapper:
        image: wrapper
        entrypoint:
            - /app/wrapper
            - /app/${POLICY_NAME}
        ports:
            - "8080:8080"
        environment:
            - DATASTORE_URL=datastore
        depends_on:
            - datastore

    opa:
        image: opa
        entrypoint:
            - /app/opa
            - run
            - --server
            - /app/${POLICY_NAME}
            - /app/${DATA_NAME}
        ports:
            - "8181:8181"

    apache-benchmark:
        image: apache
        command: ["bash", "/app/bench.sh"]
        environment:
            - INPUT_NAME=${INPUT_NAME}
        volumes:
            - "./results:/app/results"
        depends_on:
            - wrapper
            - opa
